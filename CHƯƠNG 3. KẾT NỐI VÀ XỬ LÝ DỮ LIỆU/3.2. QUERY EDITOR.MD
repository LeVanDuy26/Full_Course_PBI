Query Editor là trái tim của quy trình ETL (Extract, Transform, Load) trong Power BI, nơi dữ liệu thô được tinh chỉnh và định hình trước khi được đưa vào Mô hình dữ liệu.

### Tóm Tắt Chức Năng Chính của Query Editor

Query Editor là môi trường bắt buộc phải sử dụng để xử lý (làm sạch và định hình) dữ liệu thô thông qua các công cụ chỉnh sửa truy vấn mạnh mẽ (Query Editing Tools) và ngôn ngữ M, nhằm chuẩn bị dữ liệu sạch và tối ưu cho việc phân tích và xây dựng mô hình.

---

### I. Vai Trò Cốt Lõi của Query Editor trong Quy Trình ETL

Quy trình làm việc của Power BI bắt đầu bằng việc tổ chức dữ liệu từ dữ liệu thô (raw data). Query Editor chịu trách nhiệm cho giai đoạn **Chuyển đổi (Transform)**.

#### 1. Nguyên Tắc Xử Lý Dữ Liệu
*   **Luôn cần xử lý Data trong Queries Editor**, trước khi tải dữ liệu (load data) vào trong Power BI.
*   Power BI tạo ra các quy trình định hình và tải dữ liệu hoàn toàn tự động (ETL).

#### 2. Các Nguồn Dữ Liệu Kết Nối
Power BI có khả năng kết nối tới rất nhiều nguồn dữ liệu (data). Query Editor là nơi quản lý các kết nối này:
*   **Flat files & Folders:** (csv, text, xls, v.v.).
*   **Databases:** (SQL, Access, Oracle, IBM, Azure, v.v.).
*   **Online Services:** (Sharepoint, GitHub, Google Analytics, v.v.).
*   **Others:** (Web feeds, R scripts, Spark, v.v.).

#### 3. Mẹo Chuyên Gia: Kết nối Thư mục
Để gộp nhiều tệp trong một thư mục (yêu cầu chung cấu trúc), bạn nên sử dụng tùy chọn **“Folder”** (Get Data > More > Folder). Khi bạn thêm một tệp mới, bạn chỉ cần refresh queries và mọi thứ sẽ tự động cập nhật.

### II. Giao Diện và Cấu Trúc Cơ Bản của Query Editor

Query Editor là nơi thực hiện các công cụ chỉnh sửa truy vấn (Query Editing Tools).

#### 1. Thành Phần Giao Diện
Giao diện Query Editor bao gồm các thành phần chính sau:
*   **Query List:** Danh sách các truy vấn (bảng dữ liệu) đã được kết nối.
*   **Applied Steps:** Liệt kê các bước chuyển đổi đã áp dụng cho truy vấn.
*   **Formula Bar:** Thanh công thức hiển thị cú pháp M Language cho bước hiện tại.
*   **Table Name & Properties:** Tên và thuộc tính của bảng hiện tại.

#### 2. Các Tab Chức Năng Chính
Các công cụ được tổ chức trên ba tab chính:
*   **Tab HOME:** Chứa các cài đặt chung và các công cụ chỉnh sửa bảng phổ biến.
*   **Tab TRANSFORM:** Bao gồm các công cụ chỉnh sửa các bảng **sẵn có** đã tồn tại (ví dụ: chia/gộp, chỉnh sửa, nhóm, xử lý text).
*   **Tab ADD COLUMN:** Bao gồm các công cụ tạo bảng/cột **mới** (dựa trên một điều kiện, tính toán, công thức, ngày, v.v.).

> **Lưu ý về sự khác biệt:** Sự phân biệt giữa `Transform` và `Add Column` là ở chỗ bạn muốn thao tác trên một cột sẵn có hay thêm một cột mới.

### III. Các Công Cụ Chỉnh Sửa và Định Hình Dữ Liệu (Query Editing Tools)

Query Editor cung cấp các công cụ mạnh mẽ để đảm bảo dữ liệu sạch trước khi xây dựng mô hình.

#### 1. Chỉnh Sửa Bảng Cơ Bản
*   **Đổi loại dữ liệu:** Thay đổi kiểu dữ liệu (date, $, %, text, v.v.).
*   **Quản lý Cột:** Chọn hoặc xóa cột (sử dụng “Remove Other Columns” để chỉ giữ lại 1 cột).
*   **Quản lý Hàng:** Giữ hoặc Xóa các Hàng (sử dụng “Remove Duplicates” để xóa các dữ liệu trùng).
*   **Thao tác Cột:** Duplicate, move & rename cột.
*   **Sắp xếp:** Sắp xếp dữ liệu (A-Z, Z-A, v.v.).
*   **Cài đặt Header**.

#### 2. Công Cụ Xử Lý Văn Bản (Text Tools)
Các chức năng để làm sạch và định dạng văn bản bao gồm:
*   **Format:** Định dạng một cột text thành chữ hoa (upper), chữ thường (lower), hoặc chữ hoa đầu câu (proper case), hoặc thêm tiền tố/hậu tố.
*   **Làm sạch:** Sử dụng “Trim” để loại bỏ khoảng trắng (spaces) hoặc “Clean” để xóa các ký tự không thể in.
*   **Extract:** Trích xuất ký tự từ một cột text dựa trên chiều dài, ký tự đầu/cuối, hoặc dấu ngăn cách.
*   **Concatenate (Gộp):** Chọn hai hoặc nhiều cột để gộp các trường (tương tự hàm concatenate trong Excel).

#### 3. Công Cụ Xử Lý Số Liệu (Number Tools)
Các công cụ số học được chia làm ba nhóm:
*   **Statistics functions:** Thực hiện tính toán cơ bản (sum, min/max, average, count). *Lưu ý:* Những công cụ này trả về một **Kết quả đơn (SINGLE value)**, thường dùng để tính toán trên bảng.
*   **Standard, Scientific, Trigonometry:** Áp dụng các công thức (cộng, trừ, nhân, chia) hoặc nâng cao (power, logarithm, v.v.) cho các giá trị **trong cột**. *Lưu ý:* Các công cụ này áp dụng cho giá trị trong cột chứ không trả về một Kết quả đơn.
*   **Information tools:** Xác định kết quả Logic hoặc Nhị phân (TRUE/FALSE hoặc 1/0) dựa trên giá trị Chẵn/Lẻ.

#### 4. Công Cụ Xử Lý Ngày Tháng (Date Tools)
Các tùy chọn cơ bản bao gồm:
*   **Trích xuất:** Xuất ra các thành phần từ trường Date (Year/Month/Quarter/Week/Day).
*   **Tính toán:** `Age` (sự khác nhau giữa thời gian hiện tại và thời gian trong cột).
*   **Kết quả đơn:** `Earliest/Latest` trả về dữ liệu Date sớm nhất hoặc muộn nhất dưới dạng Kết quả đơn.
*   **Lời khuyên:** Nên sử dụng tùy chọn `Add Column` để thêm một trường/cột mới cho dữ liệu dạng Date, thay vì chỉnh sửa trực tiếp bằng `Transform`. Date tools có thể được dùng để tạo ra một calendar table hữu ích.

#### 5. Thêm Cột Chuyên Biệt
*   **Index Columns:** Chứa một danh sách giá trị để xác định vị trí (thường bắt đầu từ 0 hoặc 1), thường dùng để tạo ra các IDs để xác định quan hệ giữa các bảng.
*   **Conditional Columns:** Cho phép tạo ra một trường mới dựa trên một nguyên tắc hoặc điều kiện NẾU/THÌ.

### IV. Kết Hợp Dữ Liệu và Ngôn Ngữ M

Query Editor quản lý việc kết hợp dữ liệu từ nhiều nguồn và là nơi áp dụng ngôn ngữ M.

#### 1. Kết Hợp Truy Vấn
*   **Merging Queries (Gộp Truy Vấn):** Gộp bảng dựa trên những cột chung (tương tự VLOOKUP trong Excel). Thao tác này thêm **cột** vào một bảng đã có sẵn. *Lời khuyên:* Tốt hơn nên chia thành các bảng và tạo relationships trong Power BI thay vì luôn gộp.
*   **Appending Queries (Nối Truy Vấn):** Kết hợp các bảng có cùng kiểu cấu trúc và định dạng. Thao tác này thêm **dòng** vào một bảng đã có sẵn.
*   **Grouping Data (Nhóm Dữ Liệu):** Cho phép sắp xếp data theo các cấp độ hay các nhóm (ví dụ: giao dịch theo cửa hàng). Lưu ý: Những trường không thuộc trường điều kiện nhóm hoặc trường kết quả sẽ bị xóa.

#### 2. Ngôn Ngữ M và Custom Column
**M Language** là ngôn ngữ lập trình chức năng được sử dụng trong Power Query Editor. Nó sử dụng các đoạn mã để lọc, kết hợp, hoặc trộn lẫn dữ liệu từ một hoặc nhiều nguồn dữ liệu.

Sử dụng **Custom Column** để tạo thêm các cột mới bằng M Language.

> **Ví Dụ Code (M Language - Custom Column):**
>
> Giả sử bạn muốn tạo một cột mới tên là `Full Name` bằng cách kết hợp cột `[FirstName]` và `[LastName]` với một khoảng trắng ở giữa, bạn có thể sử dụng cú pháp M Language cơ bản trong Custom Column:
>
> ```M Language
> = [FirstName] & " " & [LastName]
> ```