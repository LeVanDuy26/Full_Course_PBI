### Tóm Tắt Phân Tích

Xử lý nâng cao trong Power Query bao gồm ba trụ cột chính: Kết hợp dữ liệu từ nhiều bảng (Merging & Appending), Định hình dữ liệu thông qua Grouping và Conditional Columns, và áp dụng ngôn ngữ lập trình chức năng **M Language** thông qua Custom Column. Các chức năng này cho phép tự động hóa hoàn toàn quy trình định hình và tải dữ liệu (ETL).

---

### I. Các Công Cụ Kết Hợp và Nhóm Dữ Liệu Nâng Cao

Các chức năng này được sử dụng để tích hợp thông tin từ nhiều nguồn hoặc tóm tắt dữ liệu ở cấp độ cao hơn.

#### 1. Merging Queries (Gộp Truy Vấn)
Merging queries cho phép gộp các bảng dựa trên các cột chung, chức năng này tương tự như hàm VLOOKUP trong Excel.
*   **Đặc điểm:** Thao tác này sẽ thêm **cột** vào một bảng đã có sẵn.
*   **Lưu ý chuyên gia:** Mặc dù Power Query cho phép gộp bảng, nhưng trong Power BI, việc chia ra thành các bảng riêng biệt và tạo **relationships** giữa chúng thường được ưu tiên hơn để có số lượng bảng ít hơn (dưới góc độ mô hình hóa), thay vì luôn gộp chúng lại.

#### 2. Appending Queries (Nối Truy Vấn)
Appending queries được sử dụng để kết hợp các bảng có cùng kiểu cấu trúc và định dạng.
*   **Đặc điểm:** Thao tác này sẽ thêm **dòng** vào một bảng đã có sẵn.
*   **Mẹo Chuyên Gia (PRO TIP):** Bạn nên sử dụng tùy chọn **“Folder”** (Get Data > More > Folder) để gộp các file trong một thư mục có chung cấu trúc. Nếu bạn thêm một file mới vào thư mục, bạn chỉ cần refresh queries và mọi thứ sẽ tự động cập nhật.

#### 3. Grouping Data (Nhóm Dữ Liệu)
Chức năng `Group By` cho phép sắp xếp dữ liệu theo các cấp độ hay các nhóm (ví dụ: data từ chi tiết ngày về theo tháng, giao dịch theo cửa hàng).
*   **Nguyên tắc:** Khi nhóm, các trường không thuộc trường điều kiện nhóm hoặc trường kết quả sẽ bị xóa.

> **Ví Dụ Code (Grouping Data - Mô tả):**
>
> Để nhóm dữ liệu và tạo cột mới tên “TotalQuantity” dựa trên “ProductKey”, sau đó tính tổng, Power Query sẽ tự động tạo một bước nhóm trong `Applied Steps`.

### II. Xử Lý Chuyên Sâu với Các Loại Cột Đặc Biệt

Trong tab `Add Column`, người dùng có thể tạo các cột mang tính chất cấu trúc hoặc điều kiện.

#### 1. Index Columns (Cột Chỉ Mục)
*   **Mục đích:** `Index Columns` chứa một danh sách giá trị để xác định vị trí trong cột hoặc trong bảng (thường bắt đầu từ 0 hoặc 1).
*   **Ứng dụng:** Cột này thường được dùng để tạo ra các IDs (key fields) để có thể xác định quan hệ giữa các bảng.

#### 2. Conditional Columns (Cột Điều Kiện)
*   **Mục đích:** `Conditional Columns` cho phép bạn tạo ra một trường mới dựa trên một nguyên tắc hoặc điều kiện nào đó (giả định NẾU/THÌ).

### III. Ứng Dụng Ngôn Ngữ M Language

Ngôn ngữ M là nền tảng cho mọi thao tác xử lý dữ liệu trong Query Editor.

#### 1. Giới Thiệu về M Language
*   **Khái niệm:** M Language là một ngôn ngữ lập trình chức năng, được sử dụng trong Power Query Editor.
*   **Chức năng:** Nó sử dụng những đoạn mã ngôn ngữ (code) cho phép lọc, kết hợp hay trộn lẫn dữ liệu từ một hoặc nhiều nguồn dữ liệu.

#### 2. Sử Dụng Custom Column
`Custom Column` được sử dụng để tạo thêm các cột mới bằng M Language. Để thực hiện, người dùng cần biết cách sử dụng một số code cơ bản đặc thù của M Language.

> **Ví Dụ Code (M Language - Custom Column):**
>
> Giả sử bạn muốn tạo một cột mới để tính toán Tổng giá trị đơn hàng (Total Order Value) bằng cách nhân `[Retail Price]` với `[Quantity]`. Trong giao diện Custom Column, bạn sẽ nhập cú pháp M Language sau:
>
> ```M Language
> = [Retail Price] * [Quantity]
> ```
>
> *Lưu ý: Công thức này trực tiếp tạo ra một cột mới dựa trên biểu thức tính toán.*

### IV. Các Chức Năng Xử Lý Dữ Liệu Chuyên Biệt

Các công cụ này cho phép tinh chỉnh sâu hơn theo kiểu dữ liệu, nằm trong tab `Transform` và `Add Column`.

#### 1. Text Tools (Công cụ Văn bản)
Các công cụ này giúp làm sạch và chuẩn hóa dữ liệu dạng text:
*   **Định dạng:** Format một cột text thành chữ hoa (`upper`), chữ thường (`lower`), hoặc chữ hoa đầu câu (`proper case`), hoặc thêm tiền tố/hậu tố.
*   **Làm sạch:** Sử dụng “Trim” để loại bỏ spaces, hoặc “Clean” để xóa các ký tự không thể in.
*   **Trích xuất:** `Extract` characters từ một cột text dựa trên chiều dài, ký tự đầu/cuối, hoặc dấu ngăn cách.
*   **Gộp:** Chọn hai hoặc nhiều cột để gộp các trường (tương tự hàm concatenate trong Excel).

#### 2. Number Tools (Công cụ Số học)
Các công cụ này được chia thành ba nhóm chính, thể hiện các cấp độ xử lý khác nhau:
*   **Statistics functions:** Thực hiện tính toán cơ bản (sum, min/max, average, count).
    *   **Note quan trọng:** Những tools này sẽ trả về một **Kết quả đơn (SINGLE value)**, và thường sử dụng để tính toán trên bảng.
*   **Standard, Scientific, và Trigonometry tools:** Cho phép áp dụng các công thức ở mức độ cơ bản (cộng, trừ, nhân, chia) hoặc nâng cao (power, logarithm, sine, tangent) cho các giá trị **ở trong cột**.
    *   **Phân biệt:** Khác với Statistics options, các công cụ này áp dụng cho các giá trị trong cột chứ không trả về một Kết quả đơn.
*   **Information tools:** Xác định kết quả Logic hoặc Nhị phân (TRUE/FALSE hoặc 1/0) dựa trên giá trị Chẵn/Lẻ.

#### 3. Date & Time Tools (Công cụ Ngày Tháng)
Các công cụ này cho phép trích xuất các thành phần thời gian và tính toán chênh lệch:
*   **Trích xuất thành phần:** Xuất ra các thành phần từ trường Date như Year/Month/Quarter/Week/Day.
*   **Tính toán:** Sử dụng `Age` để tính sự khác nhau giữa thời gian hiện tại và thời gian trong cột.
*   **Kết quả đơn:** `Earliest/Latest` trả về dữ liệu Date sớm nhất hoặc muộn nhất dưới dạng Kết quả đơn.
*   **PRO TIP:** Nên thực hiện “Add Column” để thêm một trường/cột mới cho dữ liệu dạng Date, hơn là chỉnh sửa trực tiếp dữ liệu trong “Transform”. Bạn có thể sử dụng Date tools để tạo ra một **Calendar Table** hữu ích khi làm việc trong file Power BI.